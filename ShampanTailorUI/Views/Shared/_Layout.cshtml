@using System.Security.Claims;
@using ShampanTailor.Models;
@{
    var currentBranchName = Session["CurrentBranchName"] != null ? Session["CurrentBranchName"].ToString() : "";
    var UserId = Session["UserId"] != null ? Session["UserId"].ToString() : "";
}

<!DOCTYPE html>
<html>


<head>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <meta http-equiv='cache-control' content='no-cache'>
    <meta http-equiv='expires' content='0'>
    <meta http-equiv='pragma' content='no-cache'>

    <title>@ViewData["Title"] - Shampan Tailor </title>

    <link href="~/Content/css/v361bootstrap4-toggle.min.css" rel="stylesheet" />

    <link href="~/Content/css/fonts.googleapis.css" rel="stylesheet" />

    <link href="~/Content/assets/kendoui2021/kendo/style/kendo.common.min.css" rel="stylesheet" />
    <link href="~/Content/assets/kendoui2021/kendo/style/kendo.blueopal.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/fontawesome-free/css/all.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/tempusdominus-bootstrap-4/css/tempusdominus-bootstrap-4.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/icheck-bootstrap/icheck-bootstrap.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/jqvmap/jqvmap.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/dist/css/adminlte.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/overlayScrollbars/css/OverlayScrollbars.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/daterangepicker/daterangepicker.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/summernote/summernote-bs4.min.css">

    <link rel="stylesheet" href="~/Content/AdminLte/plugins/select2/css/select2.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css">
    <link href="~/Content/AdminLte/plugins/select2-bootstrap4-theme/select2-bootstrap4.css" rel="stylesheet" />
    <link href="~/Content/AdminLte/plugins/select2-bootstrap4-theme/select2-bootstrap4.min.css" rel="stylesheet" />
    <link href="~/Content/AdminLte/plugins/bootstrap4-duallistbox/bootstrap-duallistbox.min.css" rel="stylesheet" />

    <link rel="stylesheet" href="~/Content/AdminLte/plugins/datatables-bs4/css/dataTables.bootstrap4.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/datatables-responsive/css/responsive.bootstrap4.min.css">
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/datatables-buttons/css/buttons.bootstrap4.min.css">

    <link rel="stylesheet" href="~/Content/css/typeahead.css">

    <link href="~/Content/js/toastr.min.css" rel="stylesheet" />

    <link href="~/Content/AdminLte/plugins/sweetalert2/sweetalert2.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/Content/AdminLte/plugins/sweetalert2-theme-bootstrap-4/bootstrap-4.min.css">

    @*<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">*@

    <link href="~/Content/AdminLte/CSS/Custom.css" rel="stylesheet" />
    <link href="~/Content/css/MaterialIcons.css" rel="stylesheet" />


    <link href="~/Content/css/site.css" rel="stylesheet" />
    <link href="~/Content/AdminLte/plugins/bootstrap-switch/css/bootstrap2/bootstrap-switch.min.css" rel="stylesheet" />

    <link href="~/Content/css/cdnjs.cloudflare.com_ajax_libs_fullcalendar_3.4.0_fullcalendar.min.css" rel="stylesheet" />
    <link href="~/Content/css/cdnjs.cloudflare.com_ajax_libs_fullcalendar_3.4.0_fullcalendar.print.css" rel="stylesheet" media="print" />

    <link href="~/Content/css/button.css" rel="stylesheet" />

    <script src="~/Content/AdminLte/plugins/jquery/jquery.min.js"></script>

    <script src="~/Content/assets/kendoui2021/kendo/kendo.all.min.js"></script>
    <script src="~/Content/assets/js/notify.min.js"></script>
    <script src="~/Content/js/cdnjs.cloudflare.com_ajax_libs_jquery-validate_1.19.1_jquery.validate.min.js"></script>
    <script src="~/Content/js/cdnjs.cloudflare.com_ajax_libs_jquery-validation-unobtrusive_3.2.11_jquery.validate.unobtrusive.min.js"></script>

    <script src="~/Content/js/cdnjs.cloudflare.com_ajax_libs_jquery.mask_1.14.16_jquery.mask.min.js"></script>
    <script src="~/Content/js/cdnjs.cloudflare.com_ajax_libs_jquery-maskmoney_3.0.2_jquery.maskMoney.min.js"></script>

    <script src="~/Content/AdminLte/plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="~/Content/AdminLte/plugins/chart.js/Chart.min.js"></script>
    <script src="~/Content/AdminLte/plugins/sparklines/sparkline.js"></script>
    <script src="~/Content/AdminLte/plugins/jqvmap/jquery.vmap.min.js"></script>
    <script src="~/Content/AdminLte/plugins/jqvmap/maps/jquery.vmap.usa.js"></script>
    <script src="~/Content/AdminLte/plugins/jquery-knob/jquery.knob.min.js"></script>
    <script src="~/Content/AdminLte/plugins/moment/moment.min.js"></script>
    <script src="~/Content/AdminLte/plugins/daterangepicker/daterangepicker.js"></script>
    <script src="~/Content/AdminLte/plugins/tempusdominus-bootstrap-4/js/tempusdominus-bootstrap-4.min.js"></script>


    <script src="~/Content/AdminLte/plugins/summernote/summernote-bs4.min.js"></script>

    <script src="~/Content/AdminLte/plugins/overlayScrollbars/js/jquery.overlayScrollbars.min.js"></script>

    <script src="~/Content/AdminLte/dist/js/adminlte.js"></script>

    <script src="~/Content/AdminLte/plugins/select2/js/select2.full.min.js"></script>
    <script src="~/Content/AdminLte/plugins/bootstrap4-duallistbox/jquery.bootstrap-duallistbox.min.js"></script>
    <script src="~/Content/AdminLte/plugins/sweetalert2/sweetalert2.min.js"></script>

    <script src="~/Content/js/app/custom.js"></script>
    <script src="~/Content/js/app/Site.Common.js"></script>
    <script src="~/Content/AdminLte/plugins/toastr/toastr.min.js"></script>

    <script src="~/Content/js/typeahead.bundle.js"></script>

    <script src="~/Content/AdminLte/plugins/datatables/jquery.dataTables.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-bs4/js/dataTables.bootstrap4.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-responsive/js/dataTables.responsive.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-responsive/js/responsive.bootstrap4.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-buttons/js/dataTables.buttons.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-buttons/js/buttons.bootstrap4.min.js"></script>

    <script src="~/Content/AdminLte/plugins/jszip/jszip.min.js"></script>
    <script src="~/Content/AdminLte/plugins/pdfmake/pdfmake.min.js"></script>
    <script src="~/Content/AdminLte/plugins/pdfmake/vfs_fonts.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-buttons/js/buttons.html5.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-buttons/js/buttons.print.min.js"></script>
    <script src="~/Content/AdminLte/plugins/datatables-buttons/js/buttons.colVis.min.js"></script>

    <script src="~/Content/AdminLte/plugins/jquery-ui/jquery-ui.js"></script>
    <script src="~/Content/js/cdn.jsdelivr.net_gh_gitbrent_bootstrap4-toggle@3.6.1_js_bootstrap4-toggle.min.js"></script>

    <script src="~/Content/js/4.3.0_bootbox.js"></script>
    <script src="~/Content/js/4.3.0_bootbox.min.js"></script>

    <script src="~/Content/js/CommonComboLoader.js"></script>
    <script src="~/Content/gasparesganga-jquery-loading-overlay/src/loadingoverlay.min.js"></script>
    <script src="https://cdn.ckeditor.com/4.22.1/standard/ckeditor.js"></script>
    <script src="~/Content/AdminLte/plugins/bootstrap-switch/js/bootstrap-switch.min.js"></script>


    <style>

        th[data-type="decimal"] {
            text-align: right !important;
        }

        .k-pdf-export .k-clone,
        .k-pdf-export .k-loader-container {
            display: none !important;
        }

        .k-grid tr .checkbox-align {
            text-align: center !important;
            vertical-align: middle !important;
        }

        .k-grouping-row td {
            text-align: left !important;
        }

        .searchButton {
            height: 32px !important;
        }

        .input-group button {
            margin-right: 10px;
        }

            .input-group button:last-child {
                margin-right: 0;
            }

        fieldset.scheduler-border {
            border: 1px solid #ccc;
            padding: 0px 5px 10px 5px;
            -webkit-box-shadow: 0px 0px 0px 0px #000;
            box-shadow: 0px 0px 0px 0px #000;
        }

        legend.scheduler-border {
            margin-bottom: 5px;
            font-size: 14px;
            font-weight: bold;
            text-align: left;
            width: auto;
            padding: 0 0px;
            border-bottom: none;
            margin-left: -15px;
        }

        span.k-dropdown-wrap.k-state-default {
            width: auto !important;
        }

        .kTextbox {
            width: 100%;
            height: 30px;
        }

        .KDropDown {
            width: 100%;
        }

        .k-dropdown-wrap .k-input {
            line-height: 1.8em !important;
        }

        .checkbox-label {
            display: inline-block;
            vertical-align: middle;
        }

        #lblQuick {
            display: none;
            margin-left: 30px;
            vertical-align: middle;
        }

        #btnBack img {
            height: 13px !important;
            width: 16px !important;
            border-radius: 50% !important;
            cursor: pointer !important;
        }

        /*///////////////////////////////////*/

        .auditcard {
            transform: scale(0);
            transition: 0.4s linear;
            opacity: 0;
            visibility: hidden
        }

            .auditcard.active {
                transform: scale(1);
                opacity: 1;
                visibility: visible
            }

        .auditshow {
            height: 47px;
            width: 46px;
            padding: 6px;
            border: 1px solid #d5bdbd;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            margin-right: 5px;
            background: green;
            box-shadow: rgba(0, 0, 0, 0.25) 0px 14px 28px, rgba(0, 0, 0, 0.22) 0px 10px 10px;
        }

            .auditshow:hover {
                box-shadow: none
            }

            .auditshow img {
                height: 100%;
                width: 100%;
                border-radius: 50%;
                cursor: pointer;
            }

        .card-header-audit {
            cursor: pointer !important;
            position: relative !important;
        }

        .auditHeadericon {
            position: absolute !important;
            right: 10px !important;
        }

            .auditHeadericon i {
                font-size: 25px !important;
                transform: rotate(180deg) !important;
                transition: all 0.3s linear !important;
            }

        .card-header-audit.collapsed .auditHeadericon i {
            transform: rotate(0) !important;
        }

        .bootstrap-switch-id-IsActive {
            box-shadow: none !important;
        }

        .bootstrap-switch-container .bootstrap-switch-label {
            opacity: 0;
            visibility: hidden !important;
            display: none !important;
        }

        .Onoffbtn {
            width: 82px !important;
            display: flex !important;
            align-items: center !important;
        }

        /*.card-header {
            background: #bbdceb !important;
        }*/

        /*///////////////////////////////////*/
        .bootstrap-switch {
            border: none !important;
        }

        span.bootstrap-switch-handle-off.bootstrap-switch-danger {
            width: 65px !important;
        }

        .bootstrap-switch-on.bootstrap-switch-id-IsActiveStatus.bootstrap-switch.bootstrap-switch-wrapper.bootstrap-switch-animate, .bootstrap-switch-id-IsActiveStatus.bootstrap-switch.bootstrap-switch-wrapper.bootstrap-switch-focused.bootstrap-switch-animate.bootstrap-switch-off {
            margin-left: 30px !important;
        }

        @@media (min-width:420px) and (max-width:1606px) {
            .codeWidth {
                max-width: 18.666% !important;
            }

            .csCode {
                width: 144px !important;
            }
        }

        @@media (min-width:1607px) and (max-width:2660px) {
            .codeWidth {
                max-width: 100% !important;
            }

            .csCode {
                width: 186px !important;
            }
        }

        @@media (min-width:750px) and (max-width:12800px) {
            .grndBlock label {
                white-space: nowrap !important;
                font-size: 11px !important
            }
        }

    </style>


    <style>
        #window {
            min-height: 500px;
        }

        #undo {
            text-align: center;
            position: absolute;
            white-space: nowrap;
            padding: 1em;
            cursor: pointer;
        }

        .armchair {
            float: left;
            margin: 30px 30px 120px 30px;
            text-align: center;
        }

            .armchair img {
                display: block;
                margin-bottom: 10px;
            }

        .k-window-content a {
            color: #BBB;
        }

        .k-window-content p {
            margin-bottom: 1em;
        }

        .k-window {
            z-index: 100000;
        }
    </style>

</head>

<body class="hold-transition sidebar-mini layout-fixed">
    <div class="wrapper">
        <div id="myModal" class="trkmodal"></div>
        <div class="preloader flex-column justify-content-center align-items-center">
        </div>

        <!-- Navbar -->
        <nav class="main-header navbar navbar-expand navbar-white navbar-light">
            <!-- Left navbar links -->
            <ul class="navbar-nav">
                <li class="nav-item">
                    <a class="nav-link" data-widget="pushmenu" href="#" role="button"><i class="fas fa-bars"></i></a>
                </li>
                <li class="nav-item">
                    <a href="/Common/Home/Index?branchChange=true" class="nav-link"> Change Branch </a>
                </li>
            </ul>
        </nav>

        <!-- Main Sidebar Container -->
        <aside class="main-sidebar sidebar-dark-primary elevation-4">
            <!-- Brand Logo -->
            <a href="#" class="brand-link mt-3 pb-3 mb-3 d-flex" style="margin-top: 0rem !important;margin-bottom: 0rem !important;">
                <div style="text-align: center;">
                    <img src="~/Content/AdminLte/dist/img/Tailor_Logos.png" alt="Logo" style="width: 100%; margin-left: -5px; opacity: 150;">
                </div>
            </a>

            <div class="sidebar">
                <!-- Main Sidebar Menu Binding -->
                <nav class="mt-2" id="partialViewContainer">
                </nav>

                <!-- Main Sidebar Menu Binding -->
                <div class="" style="text-align: center !important; padding: 4px 0;">
                    <div class="">
                        <a href="https://www.symphonysofttech.com/" target="_blank">
                            <img src="~/Content/AdminLte/dist/img/logo.png" alt="Symphony Logo" class="logo" height="40">
                        </a>
                        <p>.</p>
                    </div>
                </div>
            </div>

        </aside>

        <div class="content-wrapper">
            <section class="content">

                <div class="modal fade" id="partialModal" tabindex="-1" role="dialog" aria-labelledby="partialModal">
                </div>

                @Html.Partial("_rightNav")

                @RenderBody()

            </section>

        </div>

        <footer class="main-footer">
            <div class=" d-none d-sm-inline-block">
                <strong>
                    Copyright &copy; 2024 - @DateTimeOffset.Now.ToString("yyyy")
                    Symphony Softtech Ltd.
                </strong>
                All rights reserved. &nbsp;&nbsp;
            </div>


            <div class=" ml-5 ml-5 float-center d-none d-sm-inline-block ">
                <b> Branch Name : </b> <b><span style="color: red;"> @currentBranchName </span></b>
            </div>
            <div class="float-right d-none d-sm-inline-block">
                <b> Version </b> 27.April.2025
            </div>
        </footer>

        <aside class="control-sidebar control-sidebar-dark">
        </aside>
    </div>

    @RenderSection("scripts", required: false)

</body>

</html>

<script>

    $(document).ajaxStart(function () {
        $.LoadingOverlay("show");
    });

    $(document).ajaxComplete(function () {
        $.LoadingOverlay("hide");
    });

    $(document).ajaxError(function () {
        $.LoadingOverlay("hide");
    });


    $(".auditshow").click(function () {
        var operation = $('#Operation').val();
        if (operation == 'add') {
            ShowNotification(2, 'Please save data first.');
            return;
        }
        else
        {
            $(".auditcard").toggleClass("active");
        }
    });

    $("#IsActive").bootstrapSwitch();

    // for Toggle
    if ($("#filtersHeading").length) {
        document.getElementById('filtersHeading').addEventListener('click', function () {
            const filtersCollapse = document.getElementById('filtersCollapse');
            const bsCollapse = new bootstrap.Collapse(filtersCollapse, { toggle: false });
            bsCollapse.toggle();
        });
    };

    // for Toggle

</script>

<script>

    window.addEventListener("pageshow", function (event) {
        if (window.location.href.includes("Index") && sessionStorage.getItem('reloadGrid') === 'true') {
            ReloadGridData();
        };
    });

    window.addEventListener('DOMContentLoaded', function () {
        const btnBack = document.getElementById('btnBack');
        if (btnBack) {
            btnBack.addEventListener('click', function () {
                if (sessionStorage.getItem('reloadGrid') === 'true') {
                    sessionStorage.removeItem('reloadGrid');
                    window.history.go(-1);
                    location.reload();
                } else {
                    sessionStorage.setItem('reloadGrid', 'true');
                    window.history.back();
                }
            });
        }
    });

    function ReloadGridData() {
        var grid = $("#GridDataList").data("kendoGrid");
        if (grid) {
            grid.dataSource.read();
            grid.refresh();
            sessionStorage.removeItem('reloadGrid');
        }
    };


</script>

<script>

    $(document).ready(function (e) {

        loadPartialView();

        $('.misnav-link').click(function () {
            $('.dropdown-menu').toggle();
        });

        // Restore Expanded State & Icons
        setTimeout(function () {
            var expandedMenuId = localStorage.getItem('expandedMenu');
            var expandedSubMenuId = localStorage.getItem('expandedSubMenu');
            var parentMenuId = localStorage.getItem('parentMenuId');

            if (expandedMenuId) {
                var $menuItem = $('[data-menu-id="' + expandedMenuId + '"]');
                if ($menuItem.length) {
                    $menuItem.addClass('treeview-expanded');
                    $menuItem.next('ul').show();
                    $menuItem.find('.fas.fa-angle-left').removeClass('fa-angle-left').addClass('fa-angle-down');
                }
            }

            if (expandedSubMenuId) {
                var $menuItem = $('[data-menu-id="' + expandedSubMenuId + '"]');
                if ($menuItem.length) {
                    $menuItem.addClass('treeview-expanded');
                    $menuItem.next('ul').show();
                    $menuItem.find('.fas.fa-angle-left').removeClass('fa-angle-left').addClass('fa-angle-down');
                }
            }

            if (parentMenuId) {
                $('.nav-treeview .nav-link[data-menu-id="' + parentMenuId + '"]').attr('style', 'background-color: #17A2ED !important;');
            }
        }, 800);


    });


    // Parent Menu Toggle
    $('body').on('click', '.has-treeview', function (e) {
        e.stopPropagation();
        localStorage.removeItem('expandedMenu');
        localStorage.removeItem('parentMenuId');
        localStorage.removeItem('expandedSubMenu');

        var $this = $(this);
        var menuId = $this.data('menu-id');
        var isExpanded = $this.hasClass('treeview-expanded');

        // Close other expanded menus & reset icons
        $('.has-treeview.treeview-expanded').not(this).removeClass('treeview-expanded').next('ul').slideUp();
        $('.has-treeview .fa-angle-down').not($this.find('.fa-angle-left, .fa-angle-down')).removeClass('fa-angle-down').addClass('fa-angle-left');

        // Toggle clicked menu
        $this.next('ul').slideToggle();
        $this.toggleClass('treeview-expanded', !isExpanded);

        // Toggle icon state
        var $icon = $this.find('.fas.fa-angle-left, .fas.fa-angle-down');
        if (!isExpanded) {
            $icon.removeClass('fa-angle-left').addClass('fa-angle-down');
            localStorage.setItem('expandedMenu', menuId);
        } else {
            $icon.removeClass('fa-angle-down').addClass('fa-angle-left');
            localStorage.removeItem('expandedMenu');
        }
    });

    // Highlight Active Child Menu
    $('body').on('click', '.nav-treeview .nav-link', function () {
        var parentMenuId = $(this).data('menu-id');
        if (parentMenuId) {
            localStorage.setItem('parentMenuId', parentMenuId);
            $('.nav-treeview .nav-link').css('background-color', ''); // Reset others
            $(this).css('background-color', '#17A2ED'); // Highlight selected item
        }
    });

    // Dashboard
    $('body').on('click', '.Dashboard', function () {
        localStorage.removeItem('expandedMenu');
        localStorage.removeItem('parentMenuId');
        localStorage.removeItem('expandedSubMenu');
    });

    // Sub Parent Menu Toggle
    $('body').on('click', '.has-treeview-a', function (e) {
        e.stopPropagation();

        var $this = $(this);
        var menuId = $this.data('menu-id');
        var isExpanded = $this.hasClass('treeview-expanded');

        // Close other expanded submenus & reset icons
        $('.has-treeview-a.treeview-expanded').not(this).removeClass('treeview-expanded').next('ul').slideUp();
        $('.has-treeview-a .fa-angle-down').not($this.find('.fa-angle-left, .fa-angle-down')).removeClass('fa-angle-down').addClass('fa-angle-left');

        // Toggle clicked submenu
        $this.next('ul').slideToggle();
        $this.toggleClass('treeview-expanded', !isExpanded);

        // Toggle icon state
        var $icon = $this.find('.fas.fa-angle-left, .fas.fa-angle-down');
        if (!isExpanded) {
            $icon.removeClass('fa-angle-left').addClass('fa-angle-down');
            localStorage.setItem('expandedSubMenu', menuId);
        } else {
            $icon.removeClass('fa-angle-down').addClass('fa-angle-left');
            localStorage.removeItem('expandedSubMenu');
        }
    });



    function modalInit(url) {

        var modal = document.getElementById('myModal');
        $.ajax({
            url: url,
            cache: false,
            beforeSend: function () { $(".loading").show(); },
            complete: function () { $(".loading").fadeOut(200).hide("slow") },
            success: function (html) {

                modal.style.display = "block";
                $("#myModal").html(html);
            }
        });
    };

    function loadPartialView() {
        let originalPath = '/Login/_leftSideBar';
        $.get(originalPath, function (data) {
            $('#partialViewContainer').html(data);
        }).fail(function (xhr, status, error) {
            console.error("Error loading partial view:", status, error);
            $('#partialViewContainer').html('<div class="error-message">Failed to load the sidebar. Please try again later.</div>');
        });
    };

</script>
